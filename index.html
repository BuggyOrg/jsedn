<!doctype HTML>
<html>
<head>
<title>edn playground</title>
<link rel="stylesheet" href="http://codemirror.net/lib/codemirror.css">
<script src="http://codemirror.net/lib/codemirror.js"></script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://codemirror.net/mode/clojure/clojure.js"></script>
<style>
	body {
		margin: 0; padding: 0;
		font-family: helvetica;
	}

	.CodeMirror {
		border-top: 1px solid #ddd;
		border-bottom: 1px solid #ddd;
	}
	#parse {
		margin: 1em;
	}
	#output {
		border-top: 1px solid #ddd; 
		padding: 1em;
	}
	h3 {
		padding-left: 10px;
	}
	a, select {
		display: inline-block;
		padding: 10px;
		float: right; 
	}

	select { 
		margin-top: 10px;
	}

	
</style>
</head>
<body>
	<a href="http://github.com/shaunxcode/jsedn">jsedn github</a>
	<select id="files">
		<option value="nil">--choose a file--</option>
		<optgroup label="valid-edn"></optgroup>
		<optgroup label="performance"></optgroup>
	</select>
	<h3>EDN</h3> 
	<textarea id="source">[:hello {:this :is :some #{valid edn}} as-of #inst "2013"]</textarea>
	<button id="parse">parse to JSON</button>
	<h3>JSON</h3>
	<pre id="output"></pre>
	<script src="jsedn.js"></script>
	<script>
		$files = $("#files");
		var loadFileListing = function(name) {
			$.get(name + ".edn", function(tests){
				$ctrl = $files.find("[label=" + name + "]");
				jsedn.parse(tests).each(function(test){
					$ctrl.append($("<option />").text(test).attr("value", name + "/" + test));
				});
			});
		};
		loadFileListing("valid-edn");
		loadFileListing("performance"); 

		var source = CodeMirror.fromTextArea(document.getElementById("source"), {lineNumbers: true});
		var $output = $("#output");
		$("#parse").click(function(){
			try {
				$("#output").text(JSON.stringify(jsedn.toJS(jsedn.parse(source.getValue())), null, 2));
			} catch (e) {
				alert(e);
			}
		});

		$files.on("change", function(){
			$.get("edn-tests/" + $(this).val(), function(data) {
				source.setValue(data);
				$output.text("");
			});
		});

	</script>
</body>
</html>
